/*

Agrupamento de Tabelas transformadas em uma por ano

*/


AnoAgrupa:
load 
	//Atributos
	MASCARA , ANO , CODMUNICCURSO , NIVELCURSO , SUBNIVEL , MOD_PRESENC , MOD_DISTANCIA , EH_BACHARELADO , EH_LICENCPLENA , EH_LICCURTA , 
	EH_TECNO , EH_ESPECPROF , AREACURSO , NOMEAREACURSO , ORDEMORGACAD , NOMEORGACAD , CATEGADM , COD_DEP , CATADMPARTSE , CATADMCOMUN , CATADMCONFESS , CATADMFILANT , 

	//Valores
	VAGAS,INGRESSANTES,CONCLUINTES,MATRICULADOS,
	//Filtros
	1 as CO_MODALIDADE_ENSINO 	, 1 as CO_NIVEL_ACADEMICO
	
	 from 	[qvd\$(anoProcessa)\GRADUACAO_PRESENCIAL_T.qvd] (qvd);

Concatenate

load 
	//Atributos
	MASCARA , ANO , CODMUNICCURSO , NIVELCURSO , SUBNIVEL , MOD_PRESENC , MOD_DISTANCIA , EH_BACHARELADO , EH_LICENCPLENA , EH_LICCURTA , 
	EH_TECNO , EH_ESPECPROF , AREACURSO , NOMEAREACURSO , ORDEMORGACAD , NOMEORGACAD , CATEGADM , COD_DEP , CATADMPARTSE , CATADMCOMUN , CATADMCONFESS , CATADMFILANT , 
	
	//Valores
	VAGAS,INGRESSANTES,CONCLUINTES,MATRICULADOS,
	//Filtros
	2 as CO_MODALIDADE_ENSINO 	, 1 as CO_NIVEL_ACADEMICO
	
 from 	[qvd\$(anoProcessa)\Graduacao_Distancia_T.qvd] (qvd);

Concatenate

load	

	//Atributos
	MASCARA , ANO , CODMUNICCURSO , NIVELCURSO , SUBNIVEL , MOD_PRESENC , MOD_DISTANCIA , EH_BACHARELADO , EH_LICENCPLENA , EH_LICCURTA , 
	EH_TECNO , EH_ESPECPROF , AREACURSO , NOMEAREACURSO , ORDEMORGACAD , NOMEORGACAD , CATEGADM , COD_DEP , CATADMPARTSE , CATADMCOMUN , CATADMCONFESS , CATADMFILANT , 
	

	//Valores
	VAGAS,
	INGRESSANTES,CONCLUINTES,MATRICULADOS,
	//Filtros
	2 as CO_MODALIDADE_ENSINO 	, 2 as CO_NIVEL_ACADEMICO

from 	[qvd\$(anoProcessa)\FORMACAO_ESP_PRESENCIAL_T.qvd] (qvd);
	
Concatenate

load 

	//Atributos
	MASCARA , ANO , CODMUNICCURSO , NIVELCURSO , SUBNIVEL , MOD_PRESENC , MOD_DISTANCIA , EH_BACHARELADO , EH_LICENCPLENA , EH_LICCURTA , 
	EH_TECNO , EH_ESPECPROF , AREACURSO , NOMEAREACURSO , ORDEMORGACAD , NOMEORGACAD , CATEGADM , COD_DEP , CATADMPARTSE , CATADMCOMUN , CATADMCONFESS , CATADMFILANT , 
	
	//Valores
	VAGAS,INGRESSANTES,CONCLUINTES,MATRICULADOS,
	//Filtros
	1 as CO_MODALIDADE_ENSINO 	, 2 as CO_NIVEL_ACADEMICO
	
 from 	[qvd\$(anoProcessa)\FORMACAO_ESP_DISTANCIA_T.qvd] (qvd);

Concatenate


load 
	//Atributos
	MASCARA , ANO , CODMUNICCURSO , NIVELCURSO , SUBNIVEL , MOD_PRESENC , MOD_DISTANCIA , EH_BACHARELADO , EH_LICENCPLENA , EH_LICCURTA , 
	EH_TECNO , EH_ESPECPROF , AREACURSO , NOMEAREACURSO , ORDEMORGACAD , NOMEORGACAD , CATEGADM , COD_DEP , CATADMPARTSE , CATADMCOMUN , CATADMCONFESS , CATADMFILANT , 

	//Valores
	VAGAS,INGRESSANTES,CONCLUINTES,MATRICULADOS,
	//Filtros
	1 as CO_MODALIDADE_ENSINO 	, 2 as CO_NIVEL_ACADEMICO

 from 	[qvd\$(anoProcessa)\SEQUENCIAIS_COMPLE_PRESENCIAL_T.qvd] (qvd);


IF '$(anoProcessa)' = '2000' then

	Concatenate


	load 
		//Atributos
		MASCARA , ANO , CODMUNICCURSO , NIVELCURSO , SUBNIVEL , MOD_PRESENC , MOD_DISTANCIA , EH_BACHARELADO , EH_LICENCPLENA , EH_LICCURTA , 
	EH_TECNO , EH_ESPECPROF , AREACURSO , NOMEAREACURSO , ORDEMORGACAD , NOMEORGACAD , CATEGADM , COD_DEP , CATADMPARTSE , CATADMCOMUN , CATADMCONFESS , CATADMFILANT , 
		
		//Valores
		VAGAS,INGRESSANTES,CONCLUINTES,MATRICULADOS,
		//Filtros
		1 as CO_MODALIDADE_ENSINO 	, 2 as CO_NIVEL_ACADEMICO

	 from 	[qvd\$(anoProcessa)\SEQUENCIAIS_COMPLE_DIS_T.qvd] (qvd);

end if


IF '$(anoProcessa)'>='2006' then
	 
	 /**
Secomple_Distancia - Como faz?
*/
	Concatenate


	load 
		//Atributos
		MASCARA , ANO , CODMUNICCURSO , NIVELCURSO , SUBNIVEL , MOD_PRESENC , MOD_DISTANCIA , EH_BACHARELADO , EH_LICENCPLENA , EH_LICCURTA , 
	EH_TECNO , EH_ESPECPROF , AREACURSO , NOMEAREACURSO , ORDEMORGACAD , NOMEORGACAD , CATEGADM , COD_DEP , CATADMPARTSE , CATADMCOMUN , CATADMCONFESS , CATADMFILANT , 
		
		//Valores
		VAGAS,INGRESSANTES,CONCLUINTES,MATRICULADOS,
		//Filtros
		1 as CO_MODALIDADE_ENSINO 	, 2 as CO_NIVEL_ACADEMICO

	 from 	[qvd\$(anoProcessa)\SEQUENCIAIS_COMPLE_DISTANCIA_T.qvd] (qvd);

end if
 
 
 
 
store AnoAgrupa into [qvd\$(anoProcessa)\$(anoProcessa).qvd] (qvd);

drop table AnoAgrupa;


/* NAO TEM SEQUENCIAIS_COMPLE_DIS_T ? */

Transformada:
load 

	MASCARA as CO_IES,  //NO_IES
	ANO ,
	CODMUNICCURSO as CO_MUNICIPIO_CURSO,
	AREACURSO as CO_OCDE , 
	NOMEAREACURSO as NO_OCDE,
	ORDEMORGACAD as CO_ORGANIZACAO_ACADEMICA ,
	NOMEORGACAD,
	/*
	1. Bacharelado
	2. Licenciatura
	3. Tecnológico
	(.) Não aplicável (cursos com
	nivel acadêmico igual a
	sequencial de formação
	específica ou cursos com área
	básica de curso identificada
	pela variável
	TP_ATRIBUTO_INGRESSO)
	*/
	IF(EH_BACHARELADO = 'S',1,
		IF(EH_LICENCPLENA = 'S',2,
			IF (EH_LICCURTA = 'S',2,
				IF (EH_TECNO = 'S',3,'.')
				)
			)
		) as CO_GRAU_ACADEMICO, //DS_GRAU_ACADEMICO,
		
   	
	  /*
	  CO_CATEGORIA_ADMINISTRATIVA: - COD_DEP
	 1. Pública Federal
	2. Pública Estadual
	3. Pública Municipal
	4.Privada com fins lucrativos
	5. Privada sem fins lucrativos
	6. Especial
	
	CATEGADM - Categoria Administrativa:		 
	ESTADUAL
	FEDERAL
	MUNICIPAL
	PARTICULAR
	COMUN/CONFES/FILANT
	 */
	
	IF(CATEGADM = 'FEDERAL',1,
		IF(CATEGADM = 'ESTADUAL',2,
			IF (CATEGADM = 'MUNICIPAL',3,
				IF (CATEGADM = 'PARTICULAR' OR CATEGADM = 'PRIVADA',4,
					IF (CATEGADM = 'COMUN/CONFES/FILANT',5,6)
					)
				)
			)
		) as CO_CATEGORIA_ADMINISTRATIVA,	
	CO_NIVEL_ACADEMICO,
	CO_MODALIDADE_ENSINO, //nome antigo: NIVELCURSO
	VAGAS,MATRICULADOS,CONCLUINTES,INGRESSANTES
	from 
	[qvd\$(anoProcessa)\$(anoProcessa).qvd] (qvd);

	
store Transformada into [qvd\$(anoProcessa)\$(anoProcessa)_T.qvd] (qvd);

drop table Transformada; 


